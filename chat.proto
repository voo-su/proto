syntax = "proto3";

package chat;

import "common/common.proto";

option go_package = "voo.su/api/app/pb;pb";

service ChatService {
  // Creates a new chat with the specified participants
  rpc CreateChat(CreateChatRequest) returns (CreateChatResponse);

  // Retrieves the list of chats for the user
  rpc GetChats(GetChatsRequest) returns (GetChatsResponse);

  // Retrieves detailed information about a specific chat
  rpc GetChat(GetChatRequest) returns (GetChatResponse);

  // Deletes the specified chat
  rpc DeleteChat(DeleteChatRequest) returns (DeleteChatResponse);

  // Retrieves the message history for a specific chat
  rpc GetHistory(GetHistoryRequest) returns (GetHistoryResponse);

  // Sends a text message to the specified receiver
  rpc SendMessage(SendMessageRequest) returns (SendMessageResponse);

  // Sends a media file to the specified receiver
  rpc SendMedia(SendMediaRequest) returns (SendMediaResponse);

  // Marks the specified messages as viewed by the receiver
  rpc ViewMessages(ViewMessagesRequest) returns (ViewMessagesResponse);

  // Deletes specific messages from the chat (optional: revoke them)
  rpc DeleteMessages(DeleteMessagesRequest) returns (DeleteMessagesResponse);

  // Sets or clears the typing indicator for the user in a chat
  rpc SetTyping(SetTypingRequest) returns (SetTypingResponse);

  // Uploads a new sticker to the user's sticker collection
  rpc UploadSticker(UploadStickerRequest) returns (UploadStickerResponse);

  // Retrieves available stickers
  rpc GetStickers(GetStickersRequest) returns (GetStickersResponse);

  // Deletes stickers from the user's collection
  rpc DeleteSticker(DeleteStickerRequest) returns (DeleteStickerResponse);

  // Handles voting in polls or similar interactive messages
  rpc VoteHandle(VoteHandleRequest) returns (VoteHandleResponse);

  // Creates a new chat folder for organizing chats
  rpc CreateFolder(CreateFolderRequest) returns (CreateFolderResponse);

  // Retrieves all chat folders for the user
  rpc GetFolders(GetFoldersRequest) returns (GetFoldersResponse);

  // Updates the properties of an existing chat folder
  rpc UpdateFolder(UpdateFolderRequest) returns (UpdateFolderResponse);

  // Deletes a chat folder
  rpc DeleteFolder(DeleteFolderRequest) returns (DeleteFolderResponse);

  // Sorts or reorders items within a chat folder
  rpc SortFolder(SortFolderRequest) returns (SortFolderResponse);

  // Saves or updates a chat folder with specific chat items
  rpc SaveFolder(SaveFolderRequest) returns (SaveFolderResponse);

  // Pins or unpins a chat to/from the top of the chat list
  rpc ChatTop(ChatTopRequest) returns (ChatTopResponse);
}

message GetChatsRequest {}

message GetChatsResponse {
  repeated Chat chats = 1;
  repeated common.User users = 2;
  repeated common.GroupChat group_chats = 3;
}

message CreateChatRequest {
  common.Peer peer = 1;
}

message CreateChatResponse {
  Chat chat = 1;
}

message GetChatRequest {
  common.Peer peer = 1;
}

message GetChatResponse {
  Chat chat = 1;
}

message DeleteChatRequest {
  common.Peer peer = 1;
}

message DeleteChatResponse {
  bool success = 1;
}

message Chat {
  common.Peer peer = 1;
  string message = 2;
  common.EntityNotifySettings notify_settings = 3;
  int64 unread_count = 4;
  int64 updated_at = 5;
  bool is_bot = 6;
}

message GetHistoryRequest {
  common.Peer peer = 1;
  int64 message_id = 2;
  int64 limit = 3;
}

message GetHistoryResponse {
  int64 limit = 1;
  int64 message_id = 2;
  repeated common.MessageItem messages = 3;
  repeated common.User users = 4;
}

message SendMessageRequest {
  common.Peer peer = 1;
  string message = 2;
  int64 reply_to_msg_id = 3;
}

message SendMessageResponse {
  bool success = 1;
}

message SendMediaRequest {
  common.Peer peer = 1;
  common.InputMedia media = 2;
  string message = 3;
  int64 reply_to_msg_id = 4;
}

message SendMediaResponse {
  bool success = 1;
}

message ViewMessagesRequest {
  common.Peer peer = 1;
  repeated int64 message_ids = 2;
}

message ViewMessagesResponse {
  common.Peer peer = 1;
  int64 last_read_inbox_message_id = 2;
  int64 unread_count = 3;
}

message SetTypingRequest {
  common.Peer peer = 1;
}

message SetTypingResponse {
  bool success = 1;
}

message DeleteMessagesRequest {
  common.Peer peer = 1;
  repeated int64 message_ids = 2;
  bool revoke = 3;
}

message DeleteMessagesResponse {
  bool success = 1;
}

message StickerListItem {
  int64 media_id = 1;
  string src = 2;
}

message UploadStickerRequest {}

message UploadStickerResponse {
  int64 media_id = 1;
  string src = 2;
}

message GetStickersRequest {}

message GetStickersResponse {
  message SysSticker {
    int64 sticker_id = 1;
    string url = 2;
    string name = 3;
    repeated StickerListItem list = 4;
  }

  repeated SysSticker sys_sticker = 1;
  repeated StickerListItem collect_sticker = 2;
}

message DeleteStickerRequest {
  string ids = 1;
}

message DeleteStickerResponse {
  bool success = 1;
}

message ForwardMessageRequest {
  common.Peer peer = 1;
  string type = 2;
  int32 mode = 3;
  repeated int64 message_ids = 4;
  repeated int64 gids = 5;
  repeated int64 uids = 6;
}

message Folder {
  int64 id = 1;
  string name = 2;
  int32 count = 3;
  int32 sort = 4;
}

message CreateFolderRequest {
  string name = 1;
  int64 sort = 2;
}

message CreateFolderResponse{
  int64 id = 1;
}

message GetFoldersRequest {}

message GetFoldersResponse {
  repeated Folder items = 1;
}

message UpdateFolderRequest {
  int64 id = 1;
  string name = 2;
  int32 sort = 3;
}

message UpdateFolderResponse {
  int64 id = 1;
}

message DeleteFolderRequest {
  int64 id = 1;
}

message DeleteFolderResponse {}

message SortFolderRequest {
  int64 id = 1;
}

message SortFolderResponse {
  message Item {
    int64 id = 1;
    int32 sort = 2;
  }

  repeated Item items = 1;
}

message SaveFolderRequest {
  repeated common.Peer items = 1;
}

message SaveFolderResponse {}

message VoteHandleRequest {
  int64 message_id = 1;
  string options = 2;
}

message VoteHandleResponse {}

message StickerMessageRequest {
  common.Peer peer = 1;
  int64 sticker_id = 2;
}

message ChatTopRequest {
  common.Peer peer = 1;
  int32 type = 2;
}

message ChatTopResponse {}
